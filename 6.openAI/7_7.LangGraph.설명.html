<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph ê¸°ë°˜ RAG ì‹œìŠ¤í…œ ìš”ì•½</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1a73e8;
            border-bottom: 3px solid #1a73e8;
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        h2 {
            color: #3c4043;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 5px solid #a1c9f7;
        }
        .section-box {
            background-color: #e8f0fe;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c4d7f7;
        }
        .step-list {
            list-style: none;
            padding: 0;
        }
        .step-list li {
            background: #ffffff;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #34a853;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .step-title {
            font-weight: bold;
            color: #185c37;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        .code-block {
            background-color: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .highlight-state { color: #f92672; font-weight: bold; } /* TypedDict, State */
        .highlight-node { color: #66d9ef; font-weight: bold; } /* Node Function */
        .highlight-edge { color: #a6e22e; font-weight: bold; } /* Edge/Connection */
        .highlight-value { color: #fd971f; } /* Value */
        .flow-diagram {
            padding: 20px;
            background: #f7f9fb;
            border: 1px dashed #c1c1c1;
            border-radius: 8px;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ LangGraph ê¸°ë°˜ RAG ì‹œìŠ¤í…œ í•µì‹¬ ìš”ì•½</h1>

        <div class="section-box">
            <h2>1. ğŸ›ï¸ ê¸°ë³¸ êµ¬ì¡° (State, Node, Edge)</h2>
            <ul class="step-list">
                <li>
                    <div class="step-title">State (ìƒíƒœ)</div>
                    <p>ì—ì´ì „íŠ¸ ì „ì²´ì˜ ê³µìš© ì €ì¥ì†Œì…ë‹ˆë‹¤. ëª¨ë“  ë…¸ë“œê°€ ì´ <span class="highlight-state">ë”•ì…”ë„ˆë¦¬(`TypedDict`)</span>ë¥¼ ê³µìœ í•˜ë©° ê°’ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</p>
                    <div class="code-block">
                        <span class="highlight-state">class RAGState(TypedDict):</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;question: str<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;documents: List[Document]<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;search_type: str  <span style="color:#75715e;"># internal/web</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;answer: str<br>
                    </div>
                </li>
                <li>
                    <div class="step-title">Node (ë…¸ë“œ)</div>
                    <p>ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. <span class="highlight-node">State</span>ë¥¼ ì…ë ¥ë°›ì•„ ì—…ë°ì´íŠ¸í•  ë‚´ìš©ì„ <span class="highlight-node">Dict í˜•íƒœë¡œ ë°˜í™˜</span>í•©ë‹ˆë‹¤.</p>
                    <div class="code-block">
                        <span class="highlight-node">def retrieve_node(state: RAGState) -> dict:</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;# ... ê²€ìƒ‰ ë¡œì§ ì‹¤í–‰ ...<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;return {'documents': <span class="highlight-value">ê²€ìƒ‰ëœ_ë¬¸ì„œ</span>, 'search_type': <span class="highlight-value">'internal'</span>}<br>
                    </div>
                </li>
                <li>
                    <div class="step-title">Edge (ì—£ì§€)</div>
                    <p>ë…¸ë“œ ê°„ì˜ íë¦„ì„ ì •ì˜í•©ë‹ˆë‹¤.</p>
                    <div class="code-block">
                        graph.add_edge(<span class="highlight-edge">START</span>, <span class="highlight-node">'retriever'</span>)<br>
                        graph.add_edge(<span class="highlight-node">'web_search'</span>, <span class="highlight-node">'generate'</span>)<br>
                    </div>
                </li>
            </ul>
        </div>

        <h2>2. ğŸš€ ì¡°ê±´ë¶€ ë¶„ê¸° (Conditional Edge)</h2>
        <div class="section-box">
            <p>LangGraphì˜ í•µì‹¬ ê¸°ëŠ¥ìœ¼ë¡œ, íŠ¹ì • ì¡°ê±´(<span class="highlight-node">ê²°ì • í•¨ìˆ˜</span>)ì— ë”°ë¼ ë‹¤ìŒ ì‹¤í–‰ ë…¸ë“œë¥¼ ë™ì ìœ¼ë¡œ ê²°ì •í•©ë‹ˆë‹¤.</p>
            
            <div class="step-list">
                <li>
                    <div class="step-title">Decide í•¨ìˆ˜</div>
                    <p><span class="highlight-state">State</span>ë¥¼ í™•ì¸í•˜ì—¬ ë‹¤ìŒ ë…¸ë“œì˜ ì´ë¦„ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. ë°˜í™˜ ê°’ì€ <span class="highlight-value">Literal</span>ë¡œ ì •ì˜ëœ ê°’ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</p>
                    <div class="code-block">
                        <span class="highlight-node">def decide_to_generate(state: RAGState) -> Literal['generate', 'web_search']:</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;if state['documents']:<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="highlight-value">'generate'</span>  <span style="color:#75715e;"># ë¬¸ì„œê°€ ìˆìœ¼ë©´ ë‹µë³€ ìƒì„±</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;else:<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="highlight-value">'web_search'</span> <span style="color:#75715e;"># ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ì›¹ ê²€ìƒ‰</span><br>
                    </div>
                </li>
                <li>
                    <div class="step-title">Conditional Edge ì—°ê²°</div>
                    <p>ì´ í•¨ìˆ˜ë¥¼ ê·¸ë˜í”„ì— ì—°ê²°í•˜ì—¬ ë¶„ê¸°ì ì„ ë§Œë“­ë‹ˆë‹¤.</p>
                    <div class="code-block">
                        graph.<span class="highlight-edge">add_conditional_edges</span>(<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="highlight-node">'grade'</span>,  <span style="color:#75715e;"># í˜„ì¬ ë…¸ë“œ</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="highlight-node">decide_to_generate</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;{ <span class="highlight-value">'generate'</span>:<span class="highlight-value">'generate'</span>, <span class="highlight-value">'web_search'</span>: <span class="highlight-value">'web_search'</span> }<br>
                        )<br>
                    </div>
                </li>
            </div>
        </div>

        <h2>3. ğŸ—ºï¸ ìµœì¢… RAG íë¦„ ë‹¤ì´ì–´ê·¸ë¨</h2>
        <div class="flow-diagram">
            START 
              â†“
            <span class="highlight-node">retriever (VectorDB ê²€ìƒ‰)</span>
              â†“
            <span class="highlight-node">grade (ìœ ì‚¬ë„ ì ìˆ˜ ê¸°ë°˜ ë¬¸ì„œ í•„í„°ë§)</span>
              â†“
            <span class="highlight-edge">decide_to_generate (ì¡°ê±´ë¶€ ë¶„ê¸°)</span>
            
            <span style="color: #34a853;">[ë¬¸ì„œ O]</span> â†“                  [ë¬¸ì„œ X] â†“ <span style="color: #ea4335;">(ì¬ê²€ìƒ‰)</span>
                   <span class="highlight-node">generate</span> â†---------- <span class="highlight-node">web_search (ì›¹ ê²€ìƒ‰ ì‹œë®¬ë ˆì´ì…˜)</span>
                       â†“
                      END
        </div>

        <h2>4. ğŸ§© ì£¼ìš” ë…¸ë“œ ì„¤ëª… (ì²¨ë¶€ íŒŒì¼ ê¸°ë°˜)</h2>
        <div class="step-list">
            <li>
                <div class="step-title"><span class="highlight-node">retrieve_node</span></div>
                <p>ì§ˆë¬¸ì„ <span class="highlight-value">VectorDB</span>ì— ê²€ìƒ‰í•˜ì—¬ ê´€ë ¨ <span class="highlight-value">ë¬¸ì„œ</span>ì™€ <span class="highlight-value">ìœ ì‚¬ë„ ì ìˆ˜</span>ë¥¼ ë°˜í™˜í•˜ê³  Stateì— ì €ì¥í•©ë‹ˆë‹¤.</p>
                <div class="code-block">
                    docs_with_scores = <span class="highlight-value">vectorstores.similarity_search_with_score</span>(quesiton, k = 3)
                </div>
            </li>
            <li>
                <div class="step-title"><span class="highlight-node">grade_documents_node</span></div>
                <p>ê²€ìƒ‰ëœ ë¬¸ì„œë“¤ì˜ ìœ ì‚¬ë„ ì ìˆ˜ë¥¼ <span class="highlight-value">ì„ê³„ê°’(threshold=0.3)</span>ê³¼ ë¹„êµí•˜ì—¬ ê´€ë ¨ ì—†ëŠ” ë¬¸ì„œë¥¼ ì œê±°(í•„í„°ë§)í•©ë‹ˆë‹¤.</p>
                <div class="code-block">
                    if score >= <span class="highlight-value">threshold</span>:
                </div>
            </li>
            <li>
                <div class="step-title"><span class="highlight-node">web_search_node</span></div>
                <p>ë‚´ë¶€ ë¬¸ì„œê°€ ì¶©ë¶„í•˜ì§€ ì•Šì„ ê²½ìš°(ìœ ì‚¬ë„ í†µê³¼ ë¬¸ì„œ 0ê°œ), ì™¸ë¶€ ê²€ìƒ‰(ì‹œë®¬ë ˆì´ì…˜)ì„ ìˆ˜í–‰í•˜ì—¬ ìƒˆë¡œìš´ ë¬¸ì„œë¥¼ Stateì— ì¶”ê°€í•©ë‹ˆë‹¤.</p>
            </li>
            <li>
                <div class="step-title"><span class="highlight-node">generate_node</span></div>
                <p>ìµœì¢…ìœ¼ë¡œ Stateì— ì €ì¥ëœ ë¬¸ì„œë“¤(<span class="highlight-value">context</span>)ì„ ë°”íƒ•ìœ¼ë¡œ <span class="highlight-value">LLM</span>ì„ ì‚¬ìš©í•˜ì—¬ ìµœì¢… ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
            </li>
        </div>
    </div>
</body>
</html>