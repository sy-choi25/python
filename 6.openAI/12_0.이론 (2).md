# ë¡œì»¬ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (API í‚¤ ë¶ˆí•„ìš”)

## ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ë¡œì»¬ ëª¨ë‹ˆí„°ë§ì˜ í•„ìš”ì„±](#2-ë¡œì»¬-ëª¨ë‹ˆí„°ë§ì˜-í•„ìš”ì„±)
3. [SQLite ê¸°ë°˜ ì¶”ì  ì‹œìŠ¤í…œ](#3-sqlite-ê¸°ë°˜-ì¶”ì -ì‹œìŠ¤í…œ)
4. [ì»¤ìŠ¤í…€ ì½œë°± í•¸ë“¤ëŸ¬](#4-ì»¤ìŠ¤í…€-ì½œë°±-í•¸ë“¤ëŸ¬)
5. [ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„](#5-ë©”íŠ¸ë¦­-ìˆ˜ì§‘-ë°-ë¶„ì„)
6. [LangSmith vs ë¡œì»¬ ëª¨ë‹ˆí„°ë§](#6-langsmith-vs-ë¡œì»¬-ëª¨ë‹ˆí„°ë§)
7. [ì ìš© ê°€ì´ë“œ](#7-ì ìš©-ê°€ì´ë“œ)

---

## 1. ê°œìš”

### 1.1 ì´ ì½”ë“œì˜ ëª©ì 

`06_local_monitoring.py`ëŠ” **ì™¸ë¶€ API í‚¤ ì—†ì´** LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API í‚¤ ìš”êµ¬ì‚¬í•­ ë¹„êµ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  langsmith_monitoring.py (ì›ë³¸)                  â”‚
â”‚  â”œâ”€â”€ OPENAI_API_KEY       í•„ìš”                   â”‚
â”‚  â””â”€â”€ LANGCHAIN_API_KEY    í•„ìš” (LangSmith)       â”‚
â”‚                                                     â”‚
â”‚  local_monitoring.py (ëŒ€ì•ˆ)                      â”‚
â”‚  â”œâ”€â”€ OPENAI_API_KEY       í•„ìš”                   â”‚
â”‚  â””â”€â”€ ì¶”ê°€ API í‚¤           ë¶ˆí•„ìš”                 â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

| ê¸°ìˆ  | ì—­í•  | ì¥ì  |
|------|------|------|
| **SQLite** | ë°ì´í„° ì €ì¥ | íŒŒì¼ í•˜ë‚˜ë¡œ ê´€ë¦¬, ë¬´ë£Œ |
| **ì½œë°± í•¸ë“¤ëŸ¬** | ì´ë²¤íŠ¸ ìº¡ì²˜ | ì™„ì „í•œ ì œì–´ |
| **Python ë¡œê¹…** | ì‹¤ì‹œê°„ ì¶œë ¥ | ê°„ë‹¨, ì¦‰ê°ì  |

---

## 2. ë¡œì»¬ ëª¨ë‹ˆí„°ë§ì˜ í•„ìš”ì„±

### 2.1 LangSmithë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ìƒí™©

```text
ë¡œì»¬ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•œ ê²½ìš°:

1.  ë¹„ìš© ë¬¸ì œ
   â””â”€â”€ ë¬´ë£Œ í‹°ì–´ í•œë„ ì´ˆê³¼ / ì˜ˆì‚° ì œì•½

2.  ë³´ì•ˆ/ê·œì • ìš”êµ¬ì‚¬í•­
   â””â”€â”€ ë°ì´í„°ë¥¼ ì™¸ë¶€ ì„œë²„ì— ì „ì†¡í•  ìˆ˜ ì—†ìŒ

3.  ë„¤íŠ¸ì›Œí¬ ì œì•½
   â””â”€â”€ ì˜¤í”„ë¼ì¸ í™˜ê²½ / íì‡„ë§ í™˜ê²½

4.  ëª©ì 
   â””â”€â”€ ëª¨ë‹ˆí„°ë§ ì›ë¦¬ë¥¼ ì§ì ‘ ì´í•´í•˜ê³  ì‹¶ìŒ

5.  ì»¤ìŠ¤í„°ë§ˆì´ì§• í•„ìš”
   â””â”€â”€ íŠ¹ìˆ˜í•œ ë©”íŠ¸ë¦­ì´ë‚˜ ë¶„ì„ í•„ìš”
```

### 2.2 ë¡œì»¬ ëª¨ë‹ˆí„°ë§ì˜ ì¥ì 

| ì¥ì  | ì„¤ëª… |
|------|------|
| **ë¬´ë£Œ** | API ë¹„ìš© ì—†ìŒ, ì œí•œ ì—†ìŒ |
| **í”„ë¼ì´ë²„ì‹œ** | ëª¨ë“  ë°ì´í„°ê°€ ë¡œì»¬ì— ì €ì¥ |
| **ì˜¤í”„ë¼ì¸** | ì¸í„°ë„· ì—°ê²° ë¶ˆí•„ìš” |
| **ì™„ì „ ì œì–´** | ì›í•˜ëŠ” ëŒ€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• |
| **í•™ìŠµ ê°€ì¹˜** | ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì´í•´ |

---

## 3. SQLite ê¸°ë°˜ ì¶”ì  ì‹œìŠ¤í…œ

### 3.1 SQLiteë¥¼ ì„ íƒí•œ ì´ìœ 

```text
ì™œ SQLiteì¸ê°€?

 ì„¤ì¹˜ ë¶ˆí•„ìš” (Python ë‚´ì¥)
 íŒŒì¼ í•˜ë‚˜ë¡œ ëª¨ë“  ë°ì´í„° ê´€ë¦¬
 SQL ì¿¼ë¦¬ë¡œ ë³µì¡í•œ ë¶„ì„ ê°€ëŠ¥
 ë°±ì—… ë° ì´ë™ ìš©ì´ (íŒŒì¼ ë³µì‚¬)
 ê²½ëŸ‰ (ìˆ˜ë°±MB ë°ì´í„°ë„ ë¹ ë¥´ê²Œ ì²˜ë¦¬)
```

### 3.2 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```sql
-- ì‹¤í–‰ ì¶”ì  í…Œì´ë¸”
CREATE TABLE runs (
    id TEXT PRIMARY KEY,           -- UUID
    name TEXT,                     -- ì‹¤í–‰ ì´ë¦„
    run_type TEXT,                 -- 'llm', 'chain', 'retriever'
    start_time TEXT,               -- ISO í˜•ì‹ ì‹œì‘ ì‹œê°„
    end_time TEXT,                 -- ISO í˜•ì‹ ì¢…ë£Œ ì‹œê°„
    duration_seconds REAL,         -- ì†Œìš” ì‹œê°„
    input_data TEXT,               -- JSON ì…ë ¥
    output_data TEXT,              -- JSON ì¶œë ¥
    metadata TEXT,                 -- JSON ë©”íƒ€ë°ì´í„°
    status TEXT,                   -- 'running', 'success', 'error'
    error TEXT                     -- ì—ëŸ¬ ë©”ì‹œì§€
);

-- ë©”íŠ¸ë¦­ í…Œì´ë¸”
CREATE TABLE metrics (
    id INTEGER PRIMARY KEY,
    run_id TEXT,                   -- runs.id ì°¸ì¡°
    metric_name TEXT,              -- ë©”íŠ¸ë¦­ ì´ë¦„
    metric_value REAL,             -- ë©”íŠ¸ë¦­ ê°’
    recorded_at TEXT               -- ê¸°ë¡ ì‹œê°„
);

-- í† í° ì‚¬ìš©ëŸ‰ í…Œì´ë¸”
CREATE TABLE token_usage (
    id INTEGER PRIMARY KEY,
    run_id TEXT,                   -- runs.id ì°¸ì¡°
    prompt_tokens INTEGER,         -- ì…ë ¥ í† í°
    completion_tokens INTEGER,     -- ì¶œë ¥ í† í°
    total_tokens INTEGER,          -- ì´ í† í°
    estimated_cost REAL,           -- ì¶”ì • ë¹„ìš©
    model TEXT,                    -- ëª¨ë¸ëª…
    recorded_at TEXT               -- ê¸°ë¡ ì‹œê°„
);
```

### 3.3 ì¶”ì  íë¦„

```text
LLM í˜¸ì¶œ ì‹œì‘
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  start_run()    â”‚ â† runs í…Œì´ë¸”ì— ìƒˆ ë ˆì½”ë“œ INSERT
â”‚  - UUID ìƒì„±    â”‚
â”‚  - ì‹œì‘ ì‹œê°„    â”‚
â”‚  - ì…ë ¥ ë°ì´í„°  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    [LLM ì²˜ë¦¬ ì¤‘...]
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   end_run()     â”‚ â† runs í…Œì´ë¸” UPDATE
â”‚  - ì¢…ë£Œ ì‹œê°„    â”‚
â”‚  - ì†Œìš” ì‹œê°„    â”‚
â”‚  - ì¶œë ¥ ë°ì´í„°  â”‚
â”‚  - ìƒíƒœ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ record_token_   â”‚ â† token_usage í…Œì´ë¸” INSERT
â”‚   usage()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ record_metric() â”‚ â† metrics í…Œì´ë¸” INSERT
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ì»¤ìŠ¤í…€ ì½œë°± í•¸ë“¤ëŸ¬

### 4.1 LangChain ì½œë°± ì‹œìŠ¤í…œ ì´í•´

```text
LangChain ì½œë°± ë¼ì´í”„ì‚¬ì´í´:

LLM í˜¸ì¶œ:
  on_llm_start() â†’ [LLM ì²˜ë¦¬] â†’ on_llm_end() ë˜ëŠ” on_llm_error()

ì²´ì¸ ì‹¤í–‰:
  on_chain_start() â†’ [ì²´ì¸ ì²˜ë¦¬] â†’ on_chain_end()

ê²€ìƒ‰:
  on_retriever_start() â†’ [ê²€ìƒ‰] â†’ on_retriever_end()
```

### 4.2 ì½œë°± í•¸ë“¤ëŸ¬ êµ¬í˜„

```python
from langchain_core.callbacks import BaseCallbackHandler

class LocalMonitoringHandler(BaseCallbackHandler):
    """
    ë¡œì»¬ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì½œë°± í•¸ë“¤ëŸ¬
    """
    
    def __init__(self, trace_db, log_to_console=True):
        self.trace_db = trace_db
        self.log_to_console = log_to_console
        self.current_run_id = None
        self.start_time = None
    
    def on_llm_start(self, serialized, prompts, **kwargs):
        """LLM í˜¸ì¶œ ì‹œì‘ ì‹œ ì‹¤í–‰"""
        # 1. DBì— ì‹¤í–‰ ì‹œì‘ ê¸°ë¡
        self.current_run_id = self.trace_db.start_run(...)
        
        # 2. ì½˜ì†”ì— ë¡œê¹… (ì„ íƒ)
        if self.log_to_console:
            print("ğŸš€ LLM í˜¸ì¶œ ì‹œì‘...")
    
    def on_llm_end(self, response, **kwargs):
        """LLM í˜¸ì¶œ ì™„ë£Œ ì‹œ ì‹¤í–‰"""
        # 1. DBì— ì™„ë£Œ ê¸°ë¡
        self.trace_db.end_run(...)
        
        # 2. í† í° ì‚¬ìš©ëŸ‰ ê¸°ë¡
        self.trace_db.record_token_usage(...)
        
        # 3. ë©”íŠ¸ë¦­ ê¸°ë¡
        self.trace_db.record_metric(...)
```

### 4.3 ì½œë°± í•¸ë“¤ëŸ¬ ì ìš©

```python
# ì½œë°± í•¸ë“¤ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
monitoring_handler = LocalMonitoringHandler(trace_db)

# LLMì— ì½œë°± ì ìš©
llm = ChatOpenAI(
    model="gpt-4o-mini",
    callbacks=[monitoring_handler]  # â† ì—¬ê¸°ì— ì¶”ê°€
)

# ì´ì œ ëª¨ë“  LLM í˜¸ì¶œì´ ìë™ìœ¼ë¡œ ì¶”ì ë¨
response = llm.invoke("ì•ˆë…•í•˜ì„¸ìš”")  # â†’ ìë™ìœ¼ë¡œ DBì— ê¸°ë¡
```

---

## 5. ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„

### 5.1 ìˆ˜ì§‘ë˜ëŠ” ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | ì„¤ëª… | ë‹¨ìœ„ |
|--------|------|------|
| `latency` | ì‘ë‹µ ì‹œê°„ | ì´ˆ |
| `prompt_tokens` | ì…ë ¥ í† í° ìˆ˜ | ê°œ |
| `completion_tokens` | ì¶œë ¥ í† í° ìˆ˜ | ê°œ |
| `total_tokens` | ì´ í† í° ìˆ˜ | ê°œ |
| `estimated_cost` | ì¶”ì • ë¹„ìš© | USD |
| `success_rate` | ì„±ê³µë¥  | % |

### 5.2 ë¹„ìš© ì¶”ì • ë¡œì§

```python
def estimate_cost(prompt_tokens, completion_tokens, model="gpt-4o-mini"):
    """í† í° ìˆ˜ë¡œ ë¹„ìš© ì¶”ì •"""
    
    # ëª¨ë¸ë³„ ê°€ê²© (1K í† í°ë‹¹)
    pricing = {
        "gpt-4o-mini": {"input": 0.00015, "output": 0.0006},
        "gpt-4o": {"input": 0.0025, "output": 0.01},
        "gpt-3.5-turbo": {"input": 0.0005, "output": 0.0015}
    }
    
    price = pricing.get(model, pricing["gpt-4o-mini"])
    
    cost = (prompt_tokens / 1000 * price["input"] + 
            completion_tokens / 1000 * price["output"])
    
    return cost
```

### 5.3 SQL ë¶„ì„ ì˜ˆì œ

```sql
-- ì¼ë³„ ì‚¬ìš©ëŸ‰ í†µê³„
SELECT 
    DATE(start_time) as date,
    COUNT(*) as total_runs,
    AVG(duration_seconds) as avg_latency,
    SUM(total_tokens) as total_tokens
FROM runs r
JOIN token_usage t ON r.id = t.run_id
GROUP BY DATE(start_time)
ORDER BY date DESC;

-- ëª¨ë¸ë³„ ë¹„ìš© ë¶„ì„
SELECT 
    model,
    COUNT(*) as calls,
    SUM(estimated_cost) as total_cost,
    AVG(estimated_cost) as avg_cost
FROM token_usage
GROUP BY model;

-- ì‹œê°„ëŒ€ë³„ ì„±ëŠ¥ ë¶„ì„
SELECT 
    strftime('%H', start_time) as hour,
    AVG(duration_seconds) as avg_latency,
    COUNT(*) as call_count
FROM runs
WHERE status = 'success'
GROUP BY hour
ORDER BY hour;

-- ì—ëŸ¬ìœ¨ ì¶”ì´
SELECT 
    DATE(start_time) as date,
    ROUND(100.0 * SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) / COUNT(*), 2) as error_rate
FROM runs
GROUP BY DATE(start_time);
```

---

## 6. LangSmith vs ë¡œì»¬ ëª¨ë‹ˆí„°ë§

### 6.1 ê¸°ëŠ¥ ë¹„êµí‘œ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê¸°ëŠ¥ ë¹„êµí‘œ                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ê¸°ëŠ¥          â”‚  ë¡œì»¬ ëª¨ë‹ˆí„°ë§   â”‚        LangSmith           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë¹„ìš©                  â”‚ ë¬´ë£Œ            â”‚ ìœ ë£Œ (Free tier ìˆìŒ)       â”‚
â”‚ API í‚¤ í•„ìš”           â”‚  ë¶ˆí•„ìš”        â”‚  í•„ìš”                     â”‚
â”‚ ì˜¤í”„ë¼ì¸ ì‘ë™         â”‚  ê°€ëŠ¥          â”‚  ë¶ˆê°€                     â”‚
â”‚ ë°ì´í„° ì €ì¥ ìœ„ì¹˜      â”‚ ë¡œì»¬ íŒŒì¼        â”‚ í´ë¼ìš°ë“œ                    â”‚
â”‚ í”„ë¼ì´ë²„ì‹œ            â”‚  ì™„ì „ ë³´ì¥     â”‚ â–³ í´ë¼ìš°ë“œ ì €ì¥             â”‚
â”‚ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ       â”‚ â–³ ì§ì ‘ êµ¬í˜„      â”‚  ì œê³µ                     â”‚
â”‚ íŒ€ í˜‘ì—…               â”‚ â–³ ì œí•œì         â”‚  ìš©ì´                     â”‚
â”‚ ê³ ê¸‰ ë¶„ì„             â”‚ â–³ SQL ì§ì ‘ ì‘ì„± â”‚  ë‚´ì¥ ê¸°ëŠ¥                â”‚
â”‚ í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬    â”‚  ì—†ìŒ          â”‚  Hub ì œê³µ                 â”‚
â”‚ ìë™í™”ëœ í‰ê°€         â”‚ â–³ ì§ì ‘ êµ¬í˜„      â”‚  ë‚´ì¥                     â”‚
â”‚ ì»¤ìŠ¤í„°ë§ˆì´ì§•          â”‚  ììœ ë¡œì›€      â”‚ â–³ ì œí•œì                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ì„ íƒ ê°€ì´ë“œ

```text
â–¶ ë¡œì»¬ ëª¨ë‹ˆí„°ë§ ì¶”ì²œ:
  â”œâ”€â”€ ê°œì¸ í•™ìŠµ/ê°œë°œ ë‹¨ê³„
  â”œâ”€â”€ ë¹„ìš© ì ˆì•½ì´ ì¤‘ìš”í•œ ê²½ìš°
  â”œâ”€â”€ ë°ì´í„° í”„ë¼ì´ë²„ì‹œê°€ ì¤‘ìš”í•œ ê²½ìš°
  â”œâ”€â”€ ì˜¤í”„ë¼ì¸/íì‡„ë§ í™˜ê²½
  â””â”€â”€ íŠ¹ìˆ˜í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•„ìš” ì‹œ

â–¶ LangSmith ì¶”ì²œ:
  â”œâ”€â”€ íŒ€ í˜‘ì—… í”„ë¡œì íŠ¸
  â”œâ”€â”€ í”„ë¡œë•ì…˜ í™˜ê²½
  â”œâ”€â”€ ê³ ê¸‰ ë¶„ì„ ë° í‰ê°€ í•„ìš” ì‹œ
  â”œâ”€â”€ A/B í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì‹œ
  â””â”€â”€ í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬ í•„ìš” ì‹œ
```

---

## 7. ì ìš© ê°€ì´ë“œ

### 7.1 ëŒ€ì‹œë³´ë“œ êµ¬ì¶• (Streamlit ì˜ˆì œ)

```python
# dashboard.py
import streamlit as st
import sqlite3
import pandas as pd

st.title(" LLM ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ")

# DB ì—°ê²°
conn = sqlite3.connect("local_traces.db")

# ìš”ì•½ í†µê³„
st.header(" ìš”ì•½")
col1, col2, col3, col4 = st.columns(4)

df_summary = pd.read_sql("""
    SELECT 
        COUNT(*) as total_runs,
        AVG(duration_seconds) as avg_latency,
        SUM(CASE WHEN status='success' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as success_rate
    FROM runs
""", conn)

col1.metric("ì´ ì‹¤í–‰", df_summary['total_runs'][0])
col2.metric("í‰ê·  ì‘ë‹µì‹œê°„", f"{df_summary['avg_latency'][0]:.2f}s")
col3.metric("ì„±ê³µë¥ ", f"{df_summary['success_rate'][0]:.1f}%")

# ì‹œê°„ë³„ ì¶”ì´ ì°¨íŠ¸
st.header(" ì‘ë‹µì‹œê°„ ì¶”ì´")
df_hourly = pd.read_sql("""
    SELECT datetime(start_time) as time, duration_seconds
    FROM runs WHERE status='success'
    ORDER BY start_time DESC LIMIT 100
""", conn)
st.line_chart(df_hourly.set_index('time'))

# ìµœê·¼ ì‹¤í–‰ ëª©ë¡
st.header(" ìµœê·¼ ì‹¤í–‰")
df_recent = pd.read_sql("""
    SELECT id, name, duration_seconds, status, start_time
    FROM runs ORDER BY start_time DESC LIMIT 20
""", conn)
st.dataframe(df_recent)
```

### 7.2 ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„

```python
def check_alerts(trace_db):
    """ëª¨ë‹ˆí„°ë§ ì•Œë¦¼ ì²´í¬"""
    summary = trace_db.get_summary()
    
    alerts = []
    
    # ì„±ê³µë¥  ì €í•˜ ì•Œë¦¼
    if summary['success_rate'] < 95:
        alerts.append(f"âš ï¸ ì„±ê³µë¥  ì €í•˜: {summary['success_rate']}%")
    
    # í‰ê·  ì‘ë‹µì‹œê°„ ì´ˆê³¼ ì•Œë¦¼
    if summary['avg_duration_seconds'] > 5:
        alerts.append(f"âš ï¸ ì‘ë‹µì‹œê°„ ì¦ê°€: {summary['avg_duration_seconds']:.2f}s")
    
    # ë¹„ìš© ì´ˆê³¼ ì•Œë¦¼
    if summary['total_estimated_cost'] > 10:
        alerts.append(f"âš ï¸ ë¹„ìš© ì´ˆê³¼: ${summary['total_estimated_cost']:.2f}")
    
    return alerts
```

### 7.3 ë°ì´í„° ë‚´ë³´ë‚´ê¸°

```python
import pandas as pd
import sqlite3

def export_to_csv(db_path="local_traces.db", output_dir="exports"):
    """ëª¨ë‹ˆí„°ë§ ë°ì´í„°ë¥¼ CSVë¡œ ë‚´ë³´ë‚´ê¸°"""
    conn = sqlite3.connect(db_path)
    
    # ì‹¤í–‰ ê¸°ë¡
    df_runs = pd.read_sql("SELECT * FROM runs", conn)
    df_runs.to_csv(f"{output_dir}/runs.csv", index=False)
    
    # í† í° ì‚¬ìš©ëŸ‰
    df_tokens = pd.read_sql("SELECT * FROM token_usage", conn)
    df_tokens.to_csv(f"{output_dir}/token_usage.csv", index=False)
    
    # ë©”íŠ¸ë¦­
    df_metrics = pd.read_sql("SELECT * FROM metrics", conn)
    df_metrics.to_csv(f"{output_dir}/metrics.csv", index=False)
    
    conn.close()
```

---

##  ìš”ì•½

###  ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] SQLite ì¶”ì  ì‹œìŠ¤í…œ ì´í•´
- [ ] ì»¤ìŠ¤í…€ ì½œë°± í•¸ë“¤ëŸ¬ êµ¬í˜„
- [ ] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„
- [ ] SQL ì¿¼ë¦¬ë¡œ ë°ì´í„° ë¶„ì„
- [ ] ëŒ€ì‹œë³´ë“œ êµ¬ì¶• (ì„ íƒ)

### í¬ì¸íŠ¸

1. **API í‚¤ ì—†ì´ë„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥** - SQLite + ì½œë°± í•¸ë“¤ëŸ¬
2. **í”„ë¼ì´ë²„ì‹œ ë³´ì¥** - ëª¨ë“  ë°ì´í„°ê°€ ë¡œì»¬ì— ì €ì¥
3. **ì™„ì „í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§•** - ì›í•˜ëŠ” ë©”íŠ¸ë¦­ ì¶”ê°€ ê°€ëŠ¥
4. **SQLë¡œ ììœ ë¡œìš´ ë¶„ì„** - pandas ì—°ë™ìœ¼ë¡œ ì‹œê°í™” ê°€ëŠ¥

###  ìƒì„±ë˜ëŠ” íŒŒì¼

```text
í”„ë¡œì íŠ¸ í´ë”/
â”œâ”€â”€ 06_local_monitoring.py    # ì‹¤í–‰ ì½”ë“œ
â”œâ”€â”€ local_traces.db           # SQLite ë°ì´í„°ë² ì´ìŠ¤ (ìë™ ìƒì„±)
â””â”€â”€ exports/                  # CSV ë‚´ë³´ë‚´ê¸° (ì„ íƒ)
    â”œâ”€â”€ runs.csv
    â”œâ”€â”€ token_usage.csv
    â””â”€â”€ metrics.csv
```

---


ì‘ìš©ë¶„ì•¼

1. **ì›¹ ëŒ€ì‹œë³´ë“œ** - Streamlit/Gradioë¡œ ì‹œê°í™”
2. **ì•Œë¦¼ ì‹œìŠ¤í…œ** - Slack/Email ì—°ë™
3. **ë¶„ì‚° ì¶”ì ** - ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ê°„ ì¶”ì 
4. **í”„ë¡œë•ì…˜ ì „í™˜** - í•„ìš” ì‹œ LangSmithë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
